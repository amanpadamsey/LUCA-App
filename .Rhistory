ori_df <- ori_df %>% ungroup()
df %>% reframe(tidy(column_model), glance(column_model)) %>% rename_with(., function(x) {
paste(x, "column_model", sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, 1:2], .) %>%
left_join(ori_df,.,by = c('Experiment date', 'Tapir ID_unlabeled molecule (parent)'))
}
column_model <- 'lm_wo_normpoint'
df %>% reframe(tidy(column_model), glance(column_model)) %>% rename_with(., function(x) {
paste(x, "column_model", sep = "__")
}, .cols = everything())
rlang::last_trace()
df %>% reframe(tidy(column_model), glance(column_model))
df %>% reframe(tidy(.[column_model]), glance(.[column_model]))
df %>% reframe(tidy(.[[column_model]]), glance(.[[column_model]]))
.[[column_model]]
df[[column_model]]
df %>% reframe(tidy(.[[column_model]]), glance(.[[column_model]]))
df %>% reframe(tidy(column_model), glance(column_model))
df %>% reframe(tidy(lm_wo_normpoint))
df %>% reframe(tidy(column_model))
df %>% reframe(tidy({column_model}))
df %>% reframe(tidy({{column_model}}))
df %>% reframe(tidy(as.name(column_model)))
df %>% reframe(tidy(.[[column_model]]))
df %>% reframe(tidy(.[column_model]))
.[column_model]
df[column_model]
df %>% reframe(tidy(.[column_model] %>% as.vector()))
df %>% reframe(tidy(.[column_model] %>% unlist()))
df %>% reframe(tidy(.[column_model] %>% list()))
df %>% reframe(tidy(.[column_model] %>% data.frame()))
df %>% reframe(tidy(.[column_model] %>% as.data.frame()))
?is.atomic
df %>% reframe(tidy(.[column_model] %>% data.frame()))
df %>% reframe(tidy(.[column_model] %>% as.data.frame()))
df %>% reframe(tidy(.[column_model] %>% as.data.frame(.)))
df %>% reframe(tidy(.[column_model] %>% data.frame(.)))
df %>% reframe(tidy(.[[column_model]] %>% data.frame(.)))
df %>% reframe(tidy(.[[column_model]] %>% as.data.frame(.)))
df %>% reframe(tidy(.[[column_model]] %>% as.vector()))
df %>% reframe(tidy(.[[column_model]] %>% simplify()))
df %>% reframe(tidy(column_model))
df %>% reframe(tidy(.$column_model))
df %>% reframe(tidy(.$column_model))
df %>% reframe(tidy(lm_wo_normpoint))
enquo()
df %>% reframe(tidy(enquo(lm_wo_normpoint)))
df %>% reframe(tidy(!!column_model))
df %>% reframe(tidy(!!column_model))
column_model
df %>% reframe(tidy(.,column_model))
reframe(tidy(df,column_model))
reframe(tidy(df,!!column_model))
reframe(tidy(df,{{column_model}}))
reframe(tidy(df,lm_wo_normpoint))
tidy(df,lm_wo_normpoint)
tidy(lm_wo_normpoint)
tidy(df)
tidy(df$lm_wo_normpoint)
reframe(df,tidy(lm_wo_normpoint))
reframe(df,tidy(column_model))
reframe(df,tidy({{column_model}}))
reframe(df,tidy(lm_wo_normpoint))
reframe(df,tidy(column_model))
reframe(df,tidy(enquo(column_model)))
reframe(df,tidy(!!enquo(column_model)))
?enquo()
enquo(df)
enquo(column_model)
!!enquo(column_model)
as.formula(column_model)
reframe(df,tidy(as.formula(column_model)))
reframe(df,tidy(bquote(column_model)))
reframe(df,tidy(as.name(column_model)))
reframe(df,tidy(rlang::quo(column_model)))
reframe(df,tidy(wrapr::let(column_model)))
install.packages('wrapr')
reframe(df,tidy(wrapr::let(column_model)))
reframe(df,tidy(!!as.name(column_model)))
open_model <- function(df, column_model, ori_df) {
ori_df <- ori_df %>% ungroup()
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, "!!as.name(column_model)", sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, 1:2], .) %>%
left_join(ori_df,.,by = c('Experiment date', 'Tapir ID_unlabeled molecule (parent)'))
}
open_model(model_wo.pointnorm,'lm_wo_normpoint',edds_dn)
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, "!!as.name(column_model)", sep = "__")
}, .cols = everything())
open_model <- function(df, column_model, ori_df) {
ori_df <- ori_df %>% ungroup()
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, column_model, sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, 1:2], .) %>%
left_join(ori_df,.,by = c('Experiment date', 'Tapir ID_unlabeled molecule (parent)'))
}
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, column_model, sep = "__")
}, .cols = everything())
df[, 1:2]
df
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, column_model, sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, ncol(df)-1], .)
ncol(df)-1
df[, ncol(df)-1]
df[, 1:ncol(df)-1]
open_model <- function(df, column_model, ori_df) {
ori_df <- ori_df %>% ungroup()
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, column_model, sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, 1:ncol(df)-1], .) %>%
left_join(ori_df,.)
}
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, column_model, sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, 1:ncol(df)-1], .)
open_model <- function(df, column_model, ori_df) {
ori_df <- ori_df %>% ungroup()
df %>% reframe(tidy(!!as.name(column_model)), glance(!!as.name(column_model))) %>% rename_with(., function(x) {
paste(x, column_model, sep = "__")
}, .cols = everything()) %>%
bind_cols(df[, 1:ncol(df)-1], .) %>%
left_join(ori_df,.)
}
open_model(model_wo.pointnorm,'lm_wo_normpoint',edds_dn)
edds_dn <- open_model(model_wo.pointnorm,'lm_wo_normpoint',edds_dn)
View(edds_dn)
control_mabs <- c('P1AF1537','P1AA4006')
mfi_variable
edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,mfi_variable)) %>% ungroup()
edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,starts_with('estimate'))) %>% ungroup()
edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate')) %>% ungroup()
min_max_day <- function(df_grp,control_mabs,col_starts_w) {
mota <- df_grp %>% filter(`Alias_labeled molecule` == control_mabs[1]) %>% select(starts_with(col_starts_w)) %>% .[1,1] %>% as.numeric()
cd_20 <- df_grp %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>% select(starts_with(col_starts_w)) %>% .[1,1] %>% as.numeric()
df_grp %>% mutate(norm_starts_with(col_starts_w) = (starts_with(col_starts_w) - mota) / (cd_20 - mota))
min_max_day <- function(df_grp,control_mabs,col_starts_w) {
mota <- df_grp %>% filter(`Alias_labeled molecule` == control_mabs[1]) %>% select(starts_with(col_starts_w)) %>% .[1,1] %>% as.numeric()
cd_20 <- df_grp %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>% select(starts_with(col_starts_w)) %>% .[1,1] %>% as.numeric()
df_grp %>% mutate(norm_starts_with(col_starts_w) = (starts_with(col_starts_w) - mota) / (cd_20 - mota))
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df
edds -> df
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
col_starts_w <- 'estimate'
df <- edds_dn
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
cd_20 <-
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>%
mutate(norm_starts_with(col_starts_w) = (starts_with(col_starts_w) - mota) / (cd_20 - mota))
df %>%
mutate(paste0('min_max',starts_with(col_starts_w)) = (starts_with(col_starts_w) - mota) / (cd_20 - mota))
df %>%
mutate(paste0('min_max',starts_with(col_starts_w)) = (starts_with(col_starts_w) - mota) / (cd_20 - mota))
(starts_with(col_starts_w) - mota) / (cd_20 - mota)
df %>%
mutate(paste0('min_max',starts_with(col_starts_w)) := (starts_with(col_starts_w) - mota) / (cd_20 - mota))
starts_with(col_starts_w)
df %>%
mutate(paste0('min_max',col_starts_w) := (starts_with(col_starts_w) - mota) / (cd_20 - mota))
df %>%
mutate((paste0('min_max',col_starts_w)) := (starts_with(col_starts_w) - mota) / (cd_20 - mota))
df %>%
mutate(as.name(paste0('min_max',col_starts_w)) := (starts_with(col_starts_w) - mota) / (cd_20 - mota))
df %>%
mutate(!!as.name(paste0('min_max',col_starts_w)) := (starts_with(col_starts_w) - mota) / (cd_20 - mota))
col_est <- 'estimate__lm_wo_normpoint'
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_starts_w)) %>% .[1, 1] %>% as.numeric()
df %>%
mutate(!!as.name(paste0('min_max',col_starts_w)) := ((col_starts_w) - mota) / (cd_20 - mota))
df %>%
mutate('min_max_{col_starts_w}' := ((col_starts_w) - mota) / (cd_20 - mota))
col_starts_w
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
se
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
cd_20 <-
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
df %>%
mutate('min_max_{col_est}' := ((col_est) - mota) / (cd_20 - mota))
df %>%
mutate('min_max_{col_est}' := ({{col_est}} - mota) / (cd_20 - mota))
df %>%
mutate('min_max_{col_est}' := ({col_est} - mota) / (cd_20 - mota))
df %>%
mutate('min_max_{col_est}' := (!!col_est - mota) / (cd_20 - mota))
df %>%
mutate('min_max_{col_est}' := (!!as.name(col_est) - mota) / (cd_20 - mota))
df %>%
mutate('min_max_{col_est}' := (!!as.name(col_est) - mota) / (cd_20 - mota)) %>% View()
min_max_day <- function(df, control_mabs, col_est) {
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
cd_20 <-
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
df %>%
mutate('min_max_{col_est}' := (!!as.name(col_est) - mota) / (cd_20 - mota))
}
min_max_day <- function(df, control_mabs, col_est) {
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
cd_20 <-
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
df %>%
mutate('min_max_{col_est}' := (!!as.name(col_est) - mota) / (cd_20 - mota))
}
col_est
edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint'))
edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')) %>% ungroup()
edds_dn <- edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')) %>% ungroup()
df
df %>%
filter(ends_with('subtracted_dose normalized') == x)
map_dbl(control_mabs, \(x) df %>%
filter((colnames(.) %>% str_detect('subtracted_dose normalized')) == x))
(colnames(df) %>% str_detect('subtracted_dose normalized'))
(colnames(df) %>% str_detect('subtracted_dose normalized') %>% colnames(.))
(colnames(df) %>% str_detect('subtracted_dose normalized') %>% colnames(.))
(colnames(df) %>% str_detect('subtracted_dose normalized') %>% colnames(df)[.])
colnames(df) %>% str_detect('subtracted_dose normalized') %>% colnames(df)[.]
#group by experiment date and biosample id before this
column_of_interest <- colnames(df) %>% str_detect('subtracted_dose normalized') %>% colnames(df)[.]
map_dbl(control_mabs, \(x) df %>%
filter(column_of_interest == x))
map_dbl(control_mabs, \(x) df %>%
filter({[column_of_interest]} == x))
map_dbl(control_mabs, \(x) df %>%
filter({{column_of_interest}} == x))
map_dbl(control_mabs, \(x) df %>%
filter(!!as.name(column_of_interest) == x))
map_dbl(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x))
map_dbl(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>% .[[column_of_interest]][[1]])
map_dbl(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>% .[[column_of_interest]][1])
map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>% .[[column_of_interest]][1])
map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>%  %>% select(estimate__lm_wo_normpoint) %>% .[1, 1] %>% as.numeric() )
map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>% select(estimate__lm_wo_normpoint) %>% .[1, 1] %>% as.numeric() )
control_slopes <- map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>%
select(estimate__lm_wo_normpoint) %>%
.[1, 1] %>% as.numeric() )
control_slopes
names(control_slopes) <- control_mabs
control_slopes
df[paste0(mfi_variable, '_BG subtracted_dose_control normalized')] <-
(df[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] - df[['Incubation time']] *
control_slopes[1]) / (control_slopes[2] - control_slopes[1])
df[['Incubation time']]
df[['Incubation time']] *
control_slopes[1]
df[['Incubation time']] * 45
control_slopes[1]
control_slopes[1]*54
control_slopes <- map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>%
select(estimate__lm_wo_normpoint) %>%
.[1, 1] %>% simplify() )
names(control_slopes) <- control_mabs
df[paste0(mfi_variable, '_BG subtracted_dose_control normalized')] <-
(df[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] - df[['Incubation time']] *
control_slopes[1]) / (control_slopes[2] - control_slopes[1])
control_slopes
control_slopes[1]*45
control_slopes[[1]]*45
control_slopes <- map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>%
select(estimate__lm_wo_normpoint) %>%
.[1, 1] %>% as.numeric() )
names(control_slopes) <- control_mabs
df[paste0(mfi_variable, '_BG subtracted_dose_control normalized')] <-
(df[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] - df[['Incubation time']] *
control_slopes[1]) / (control_slopes[[2]] - control_slopes[[1]])
df[paste0(mfi_variable, '_BG subtracted_dose_control normalized')] <-
(df[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] - df[['Incubation time']] *
control_slopes[[1]]) / (control_slopes[[2]] - control_slopes[[1]])
View(df)
if (length(control_mabs) == 2)
(length(control_mabs) == 2)
min_max_day <- function(df, control_mabs, col_est) {
if (length(control_mabs) == 2) {
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
cd_20 <-
df %>% filter(`Alias_labeled molecule` == control_mabs[2]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
df <- df %>%
mutate('min_max_{col_est}' := (!!as.name(col_est) - mota) / (cd_20 - mota))
} else if (length(control_mabs) == 1) {
mota <-
df %>%
filter(`Alias_labeled molecule` == control_mabs[1]) %>%
select(starts_with(col_est)) %>% .[1, 1] %>% as.numeric()
df <- df %>%
mutate('min_max_{col_est}' := (!!as.name(col_est)) / (mota))
} else {
stop(' Please enter at least one control mab ')
}
df
}
edds_dn %>% min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')
edds_dn %>% min_max_day(.,control_mabs[1],'estimate__lm_wo_normpoint')
edds_dn %>% min_max_day(.,control_mabs[c(1,1,1)],'estimate__lm_wo_normpoint')
edds_dn %>% min_max_day(.,control_mabs[1],'estimate__lm_wo_normpoint') %>% View()
# Normalize points --------------------------------------------------------
# do linear regression of controls and find 'fitted' points for each control
point_norm  <- function(df,mfi_variable,control_mabs) {
#group by experiment date and biosample id before this
#column_of_interest <- colnames(df) %>% str_detect('subtracted_dose normalized') %>% colnames(df)[.]
control_slopes <- map(control_mabs, \(x) df %>%
filter(`Alias_labeled molecule` == x) %>%
select(estimate__lm_wo_normpoint) %>%
.[1, 1] %>% as.numeric() )
names(control_slopes) <- control_mabs
if (length(control_mabs) == 2){
df[paste0(mfi_variable, '_BG subtracted_dose_control normalized')] <-
(df[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] - df[['Incubation time']] *
control_slopes[[1]]) / (control_slopes[[2]] - control_slopes[[1]])
} else if (length(control_mabs) == 1){
df[paste0(mfi_variable, '_BG subtracted_dose_control normalized')] <-
(df[[paste0(mfi_variable, '_BG subtracted_dose normalized')]]) / control_slopes[[1]]
}
df
}
edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')) %>% ungroup()
edds_dn <- edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')) %>% ungroup()
edds_dn %>% group_by(`Experiment date`, `Biosample ID`) %>% do(point_norm(.,control_mabs = control_mabs))
edds_dn %>% group_by(`Experiment date`, `Biosample ID`) %>% do(point_norm(.,mfi_variable,control_mabs))
edds_dn <-
edds_dn %>%
group_by(`Experiment date`, `Biosample ID`) %>%
do(point_norm(., mfi_variable, control_mabs))
View(edds_dn)
edds_dn <-
edds_dn %>%
group_by(`Experiment date`, `Biosample ID`) %>%
do(point_norm(., mfi_variable, control_mabs)) %>% ungroup()
edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Tapir ID_unlabeled molecule (parent)`,`Biosample ID`) %>%
do(lm_w_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose_control normalized')]] ~ 0 + .[['Incubation time']]),
data = .)
edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Experiment date`,
`Tapir ID_unlabeled molecule (parent)`,
`Biosample ID`) %>%
do(lm_wo_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] ~ 0 + .[['Incubation time']]),
data = .) -> model_wo.pointnorm
edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Experiment date`,
`Tapir ID_unlabeled molecule (parent)`,
`Biosample ID`) %>%
do(lm_wo_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] ~ 0 + .[['Incubation time']],data = .)
) -> model_wo.pointnorm
model_wo.pointnorm
edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Tapir ID_unlabeled molecule (parent)`,`Biosample ID`) %>%
do(lm_w_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose_control normalized')]] ~ 0 + .[['Incubation time']],data = .))
model_w.pointnorm <- edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Tapir ID_unlabeled molecule (parent)`,`Biosample ID`) %>%
do(lm_w_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose_control normalized')]] ~ 0 + .[['Incubation time']],data = .))
edds_dn <- open_model(model_w.pointnorm,'lm_wo_normpoint',edds_dn)
edds_dn <- open_model(model_w.pointnorm,'lm_w_normpoint',edds_dn)
View(edds_dn)
write_csv(edds_dn,'edds_test.csv')
mfi_variable %in% colnames(edds_dn)
c(mfi_variable,'Fluorescence_dosing solution') %in% colnames(edds_dn)
c(mfi_variable,'Fluorescence_dosing solution') %in% colnames(edds_dn) %>% all()
c(mfi_variable,'Fluorescence_dosing solutions') %in% colnames(edds_dn) %>% all()
mfi_variable
mfi_variable %in% colnames(edds_dn)
runApp()
edds_dn
# final check -------------------------------------------------------------
edds_dn <- read_csv('./tmdd testing/edds_abc.csv')
edds_dn
View(edds_dn)
edds_dn[['Fluorescence_dosing solution']] <- 30000
control_mabs <- c('P1AF1537','P1AA4006')
mfi_variable
mfi_variable <- 'Geometric Mean : pHAb-A'
edds_dn <-  edds_dn |>
mutate(`Viability` = `Cell count_morphology_live` / `Cell count_morphology`,
`Cell fraction_gated` = `Cell count_morphology_live` /`Cell count_total`) |>
group_by(`Experiment date`, `Biosample ID`, `Incubation time`) %>%
do(mock_sub(.,mfi_variable)) |>
mutate(
'{mfi_variable}_BG subtracted_dose normalized' := .data[[paste0(mfi_variable, '_BG subtracted')]] /
`Fluorescence_dosing solution`
)
edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Experiment date`,
`Tapir ID_unlabeled molecule (parent)`,
`Biosample ID`) %>%
do(lm_wo_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] ~ 0 + .[['Incubation time']],data = .)
) -> model_wo.pointnorm
edds_dn <- open_model(model_wo.pointnorm,'lm_wo_normpoint',edds_dn)
edds_dn <- edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')) %>% ungroup()
edds_dn <-
edds_dn %>%
group_by(`Experiment date`, `Biosample ID`) %>%
do(point_norm(., mfi_variable, control_mabs)) %>% ungroup()
model_w.pointnorm <- edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Tapir ID_unlabeled molecule (parent)`,`Biosample ID`) %>%
do(lm_w_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose_control normalized')]] ~ 0 + .[['Incubation time']],data = .))
edds_dn <- open_model(model_w.pointnorm,'lm_w_normpoint',edds_dn)
View(edds_dn)
runApp()
# final check -------------------------------------------------------------
edds_dn <- read_csv('./tmdd testing/edds_abc.csv')
edds_dn[['Fluorescence_dosing solution']] <- 30000
control_mabs <- c('hfhg')
mfi_variable <- 'Geometric Mean : pHAb-A'
edds_dn <-  edds_dn |>
mutate(`Viability` = `Cell count_morphology_live` / `Cell count_morphology`,
`Cell fraction_gated` = `Cell count_morphology_live` /`Cell count_total`) |>
group_by(`Experiment date`, `Biosample ID`, `Incubation time`) %>%
do(mock_sub(.,mfi_variable)) |>
mutate(
'{mfi_variable}_BG subtracted_dose normalized' := .data[[paste0(mfi_variable, '_BG subtracted')]] /
`Fluorescence_dosing solution`
)
edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Experiment date`,
`Tapir ID_unlabeled molecule (parent)`,
`Biosample ID`) %>%
do(lm_wo_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose normalized')]] ~ 0 + .[['Incubation time']],data = .)
) -> model_wo.pointnorm
edds_dn <- open_model(model_wo.pointnorm,'lm_wo_normpoint',edds_dn)
edds_dn <- edds_dn %>% ungroup() %>% group_by(`Experiment date`,`Biosample ID`) %>%
do(min_max_day(.,control_mabs,'estimate__lm_wo_normpoint')) %>% ungroup()
edds_dn <-
edds_dn %>%
group_by(`Experiment date`, `Biosample ID`) %>%
do(point_norm(., mfi_variable, control_mabs)) %>% ungroup()
model_w.pointnorm <- edds_dn %>% filter(!str_detect(`Alias_labeled molecule`,
regex('mock', ignore_case = TRUE))) %>%
group_by(`Tapir ID_unlabeled molecule (parent)`,`Biosample ID`) %>%
do(lm_w_normpoint = lm(.[[paste0(mfi_variable, '_BG subtracted_dose_control normalized')]] ~ 0 + .[['Incubation time']],data = .))
runApp()
runApp()
